<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= pet.name %></title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      .pet-hero-img {
        width: 100%;
        height: 420px;
        object-fit: cover;
        border-radius: 12px;
      }
    </style>
  </head>

  <body class="bg-light">
    <%- include("../navbar") %>

    <main class="container py-4">
      <a href="/pets" class="text-decoration-none">&larr; Back to listings</a>

      <div class="row g-4 mt-2">
        <div class="col-12 col-lg-6">
          <div class="card shadow-sm p-2">
            <% if (pet.picture) { %>
            <img class="pet-hero-img" src="<%= pet.picture %>" alt="<%= pet.name %>" />
            <% } else { %>
            <div class="bg-secondary-subtle" style="height: 420px; border-radius: 12px"></div>
            <% } %>
          </div>
        </div>

        <div class="col-12 col-lg-6">
          <div class="card shadow-sm">
            <div class="card-body">
              <h1 class="h3 mb-1"><%= pet.name %></h1>
              <div class="text-muted mb-3"><%= pet.category %></div>

              <p class="mb-3"><%= pet.description %></p>

              <div class="mb-2">
                <strong>Date of birth:</strong> <%= pet.dob.toDateString() %>
              </div>

              <div class="mb-2">
                <strong>Age:</strong>
                <span data-dob="<%= pet.dob.toISOString().slice(0,10) %>">â€”</span>
              </div>

              <div class="mb-3"><strong>Listed by:</strong> <%= pet.owner?.username %></div>

              <hr />

              <h2 class="h6">Contact</h2>

              <% if (user) { %>
              <div class="alert alert-success mb-0">
                <strong>Phone:</strong> +973 <%= pet.owner?.phoneNumber %>
              </div>
              <% } else { %>
              <div class="alert alert-warning mb-0">
                Please <a href="/auth/sign-in">sign in</a> to view the phone number.
              </div>
              <% } %>

              <% if (user && pet.owner && pet.owner._id && pet.owner._id.equals(user._id)) { %>
              <div class="d-flex gap-2 mt-3">
                <a class="btn btn-outline-secondary" href="/pets/<%= pet._id %>/edit">Edit</a>

                <button
                  class="btn btn-danger"
                  type="button"
                  data-bs-toggle="modal"
                  data-bs-target="#deletePetModal"
                >
                  Remove
                </button>
              </div>

              <div
                class="modal fade"
                id="deletePetModal"
                tabindex="-1"
                aria-hidden="true"
              >
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">Remove listing?</h5>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                      ></button>
                    </div>

                    <div class="modal-body">
                      This will remove <b><%= pet.name %></b> from the listings.
                    </div>

                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-outline-secondary"
                        data-bs-dismiss="modal"
                      >
                        Cancel
                      </button>

                      <form
                        action="/pets/<%= pet._id %>/delete"
                        method="POST"
                        class="m-0"
                      >
                        <button type="submit" class="btn btn-danger">
                          Remove
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/forms.js"></script>
  </body>
</html>
